<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Grant J Butler</title><description></description><link>https://grantjbutler.com/</link><language>en</language><lastBuildDate>Mon, 11 Sep 2023 18:25:45 -0400</lastBuildDate><pubDate>Mon, 11 Sep 2023 18:25:45 -0400</pubDate><ttl>250</ttl><atom:link href="https://grantjbutler.com/feed.rss" rel="self" type="application/rss+xml"/><item><guid isPermaLink="true">https://grantjbutler.com/articles/using-tailwind-with-publish</guid><title>Making Tailwind and Publish Play Nice With Each Other</title><description></description><link>https://grantjbutler.com/articles/using-tailwind-with-publish</link><pubDate>Mon, 11 Sep 2023 18:25:44 -0400</pubDate><content:encoded><![CDATA[<p>I won't lie. I'm not a designer. I may have an intiution about whether something is designed well or not by looking at it, but if you asked me to make something from scratch, while I may be able to make something usable, it's certainly not going to be the best designed thing you've ever seen.</p><p>When it comes to web development, one of the first things I pull into a new project is <a href="https://tailwindcss.com">Tailwind</a>. It's a utility-first CSS framework with some solid defaults that makes it easy to build something that looks good, while not boxing you in to something that looks generic. For someone like me, it's a great tool for helping me build something that looks decent.</p><p>Most of the time, Tailwind gets integrated with other build tools, like webpack or vite, where the generation of your site's styles are just one piece of a larger build process, which may copy images around, compile Vue or React components into straight JavaScript, and more. For this site, though, we're using <a href="https://github.com/johnsundell/Publish">Publish</a> as our static site generator, which doesn't leverage any of these build tools already as part of its site generation process. While we could pull one of them it, it'd be overkill since we wouldn't be using any of their other features.</p><p>Fortunately, in addition to the above integrations with existing frontend built tools, you can run Tailwind directly with a command line tool to generate styles from your source code. With just a little bit of work, we can wrap up calling out to their CLI tool into a <code>PublishingStep</code> to integrate Tailwind into the build pipeline for our Publish site.</p><h2>Installing Tailwind</h2><p>Before we start writing any of the Swift code of our <code>PublishingStep</code>, we need to make sure that Tailwind is installed and properly configured. We can follow the <a href="https://tailwindcss.com/docs/installation">installations docs</a> for their CLI tool, using the root directory of our Swift package as the location of our NPM package. Since we're following the structure of a Swift package for our code, and the structure of a Publish site for our content, we'll need to update our <code>tailwind.config.js</code> file to tell it where to look for styles.</p><pre><code class="language-js"><span class="token comment">/** @type {import('tailwindcss').Config} */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"./Sources/**/*.swift"</span><span class="token punctuation">,</span>
    <span class="token string">"./Content/**/*.{md,html,js}"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">theme</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extend</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre><p>The two places that we tell Tailwind to look for styles are our Swift files (so it can detect which styles we may be using in our site's theme), and our content files (so it can detect any styles in any of the Markdown, HTML, or JavaScript files we may write). This is what works for me for my site, so if you have other files that have Tailwind styles, make sure you add the paths to the config file.</p><p>With Tailwind's configuration updated, we can start working on writing the <code>PublishingStep</code> that'll invoke Tailwind.</p><h2>Building the <code>PublishingStep</code></h2><p>First things first, we need to import a few different targets. We need the <code>Publish</code> target, so we can get access to the API we need for creating this <code>PublishingStep</code>. We'll pull in the <code>ShellOut</code> target, to give us a streamlined interface to invoking command line executables, like the Tailwind CLI tool. Finally, we'll pull in the <code>Files</code> target to give us a set of convenience APIs for interacting with the filesystem.</p><p>With the targets imported, we can create the factory method for our <code>PublishingStep</code> that will invoke Tailwind:</p><pre><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Files</span>
<span class="token keyword">import</span> <span class="token class-name">Publish</span>
<span class="token keyword">import</span> <span class="token class-name">ShellOut</span>

<span class="token keyword">extension</span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">generateTailwindCSS</span><span class="token punctuation">(</span>
        inputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Resources/styles.css"</span></span><span class="token punctuation">,</span>
        outputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"styles.css"</span></span>
    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Generate Tailwind CSS"</span></span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token punctuation">{</span> context <span class="token keyword">in</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>This step takes in two arguments: the source CSS file that has the Tailwind directives in it, and an output file where the generated CSS should be put within Publish's <code>Output</code> folder.</p><p>Now we can start to fill in the body of our step to actually invoke Tailwind:</p><pre><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Files</span>
<span class="token keyword">import</span> <span class="token class-name">Publish</span>
<span class="token keyword">import</span> <span class="token class-name">ShellOut</span>

<span class="token keyword">extension</span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">generateTailwindCSS</span><span class="token punctuation">(</span>
        inputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Resources/styles.css"</span></span><span class="token punctuation">,</span>
        outputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"styles.css"</span></span>
    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Generate Tailwind CSS"</span></span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token punctuation">{</span> context <span class="token keyword">in</span>
            <span class="token keyword">try</span> <span class="token function">shellOut</span><span class="token punctuation">(</span>
                to<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"npx"</span></span><span class="token punctuation">,</span>
                arguments<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"tailwindcss"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"-i"</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> inputPath<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"-o"</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">outputFile</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> outputPath<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"--minify"</span></span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Using the <code>shellOut</code> function provided by the <code>ShellOut</code> package, we run the <code>tailwindcss</code> command by way of <code>npx</code>, providing our source CSS file as the input path and the location where the generated CSS should live as the output path. We also tell Tailwind to minify the CSS, to reduce the size of the generated file. However, if we include this step in our build pipeline and try to run it, we'll run into a few issues.</p><p>First, <code>outputFile(at:)</code> actually expects the file at the given path to exist. Even if all we're wanting to do is determine the path to a file in Publish's <code>Output</code> directory so we can give it to Tailwind, the method will still check to see if the file exists and throw an error if it doesn't. We can work around this by creating the file ourselves before invoking Tailwind by utilizing the <code>createOutputFile(at:)</code> method on the publishing context. Like <code>outputFile(at:)</code>, this method returns a <code>File</code> type, which we can use to get a path to pass on to Tailwind:</p><pre><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Files</span>
<span class="token keyword">import</span> <span class="token class-name">Publish</span>
<span class="token keyword">import</span> <span class="token class-name">ShellOut</span>

<span class="token keyword">extension</span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">generateTailwindCSS</span><span class="token punctuation">(</span>
        inputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Resources/styles.css"</span></span><span class="token punctuation">,</span>
        outputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"styles.css"</span></span>
    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Generate Tailwind CSS"</span></span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token punctuation">{</span> context <span class="token keyword">in</span>
            <span class="token keyword">try</span> <span class="token function">shellOut</span><span class="token punctuation">(</span>
                to<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"npx"</span></span><span class="token punctuation">,</span>
                arguments<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"tailwindcss"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"-i"</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> inputPath<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"-o"</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">createOutputFile</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> outputPath<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"--minify"</span></span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>The next error we'll run in to depends on if we're running our build pipeline from within Xcode. If you're running in Xcode, you'll likely see an error in the console stating that <code>npx</code> cannot be found. Because we're using Publish to generate our site, we end up running a command line executable to perform that work. That executable inherits the environment of where it's running, which includes any modifications you may have made to your <code>$PATH</code> environment variable to locate various executables. Those modifications may not be inherited by Xcode, so when you run from within Xcode, it's likely that <code>npx</code> won't be found and the style generation step will fail.</p><p>To fix this for when we generate our site from within Xcode, we can see if a path to <code>npx</code> has been provided as an environment variable and use that, falling back to just calling <code>npx</code> and letting it be resolved based off of the <code>$PATH</code> in the current environment. Since we'll be using the <code>ProcessInfo</code> type for inspecting the environment, we'll also need to import Foundation to get access to that API:</p><pre><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Files</span>
<span class="token keyword">import</span> <span class="token class-name">Foundation</span>
<span class="token keyword">import</span> <span class="token class-name">Publish</span>
<span class="token keyword">import</span> <span class="token class-name">ShellOut</span>

<span class="token keyword">extension</span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">generateTailwindCSS</span><span class="token punctuation">(</span>
        inputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Resources/styles.css"</span></span><span class="token punctuation">,</span>
        outputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"styles.css"</span></span>
    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Generate Tailwind CSS"</span></span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token punctuation">{</span> context <span class="token keyword">in</span>
            <span class="token keyword">try</span> <span class="token function">shellOut</span><span class="token punctuation">(</span>
                to<span class="token punctuation">:</span> <span class="token class-name">ProcessInfo</span><span class="token punctuation">.</span>processInfo<span class="token punctuation">.</span>environment<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"NPX_BINARY"</span></span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"npx"</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                arguments<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"tailwindcss"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"-i"</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> inputPath<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"-o"</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">createOutputFile</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> outputPath<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"--minify"</span></span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>We can then set the <code>NPX_BINARY</code> environment variable to where <code>npx</code> lives from within the "Run" section of Xcode's Scheme Editor:</p><img src="https://grantjbutler.com//img/articles/using-tailwind-with-publish/environment-variables.png" alt="Xcode's Scheme Editor, highlighting the environment variables for the Publish project's scheme, which has an NPX_BINARY key-value pair."/><p>If we try to run our publishing step now, we may get one last error, again stemming from if we're running our build pipeline from within Xcode or not. By default, when Xcode runs a built command line tool, it'll set the working directory for that process to the built products directory, which will usually be some folder that lives in the depths of <code>~/Library/Developer/Xcode/</code>. This folder contains a slew of build artifacts related to your project, including the executable that generates your site, but does not contain your source code, resources, or other content. When you try to run <code>npx</code> from this folder, it can't find an installation of Tailwind to generate the styles. There's a couple of ways we could resolve this problem.</p><p>First, we could fix this from within Xcode by opening the Scheme Editor again and specifying an explicit working directory in the "Options" tab:</p><img src="https://grantjbutler.com//img/articles/using-tailwind-with-publish/working-directory.png" alt="Xcode Scheme Editor, showing the "Options" tab where the "Working Directory" option lives, allowing us to customize where the executable runs."/><p>Alternatively, we could fix this by being explicit about in which directory we run <code>npx</code>. By getting a path to the package's root directory and providing that to our <code>shellOut</code> call, we can set the working directory for the invocation of <code>npx</code>, so it can find the Tailwind installation:</p><pre><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Files</span>
<span class="token keyword">import</span> <span class="token class-name">Foundation</span>
<span class="token keyword">import</span> <span class="token class-name">Publish</span>
<span class="token keyword">import</span> <span class="token class-name">ShellOut</span>

<span class="token keyword">extension</span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">generateTailwindCSS</span><span class="token punctuation">(</span>
        inputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Resources/styles.css"</span></span><span class="token punctuation">,</span>
        outputPath<span class="token punctuation">:</span> <span class="token class-name">Path</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"styles.css"</span></span>
    <span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">PublishingStep</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span>named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"Generate Tailwind CSS"</span></span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token punctuation">{</span> context <span class="token keyword">in</span>
            <span class="token keyword">try</span> <span class="token function">shellOut</span><span class="token punctuation">(</span>
                to<span class="token punctuation">:</span> <span class="token class-name">ProcessInfo</span><span class="token punctuation">.</span>processInfo<span class="token punctuation">.</span>environment<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"NPX_BINARY"</span></span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"npx"</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                arguments<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"tailwindcss"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"-i"</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> inputPath<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"-o"</span></span><span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">createOutputFile</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> outputPath<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"--minify"</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                at<span class="token punctuation">:</span> <span class="token keyword">try</span> context<span class="token punctuation">.</span><span class="token function">folder</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"/"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>path
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>With this last change in place, we're in a state where this publishing step works! With this added to our build pipeline, Tailwind will generate someCSS and put it in Publish's <code>Output</code> folder for use in your website. While you can copy the code from this page and pull it into your site, I've gone ahead and bundled it up in its own <a href="https://github.com/grantjbutler/TailwindPublishPlugin">Publish plugin</a>. If you have a need to generate your site's syles with Tailwind, check it out and let me know how it works for you!</p>]]></content:encoded></item><item><guid isPermaLink="true">https://grantjbutler.com/articles/so-lets-try-this-blogging-thing-again</guid><title>So, Let's Try This &quot;Blogging&quot; Thing Again...</title><description></description><link>https://grantjbutler.com/articles/so-lets-try-this-blogging-thing-again</link><pubDate>Sun, 27 Aug 2023 14:49:32 -0400</pubDate><content:encoded><![CDATA[<p>Over the years, I've tried blogging a number of times, but it's never really stuck. While I may start strong, I would always eventaully fall off with posting things to the blog. Eventually, my personal site just turned into a landing page with links out to other places where I'm active or would post things.</p><p>But now I'm going to give it another shot. I've worked on a couple of different projects recently where I've thought to myself "you know, no one's really talked about building something like this. I should write about it." I've also got a number of projects planned where I could see there being some interesting topics to write about. But my current website doesn't really allow for writing things. So I rebuilt it.</p><p>The new site is built using John Sundell's <a href="https://github.com/JohnSundell/Publish">Publish</a>. It's a static site generator built with Swift that can (among other things) process Markdown files to build a website consiting of a bunch of HTML files. Pretty much par for the course if you're used to other static site generators like <a href="https://jekyllrb.com">Jekyll</a> or <a href="https://gohugo.io">Hugo</a>.</p><p>The nice thing about Publish being written in Swift is that I know Swift, which means I can easily extend it if I need to. I've already done a number of custom things to build this website and make the experience of developing the site a little bit nicer. Some of those things, I plan to write about here and even potentially open source for others to use.</p><p>So, that's that. Though I have several more things I want to do with this website, it's now in a state where I can start writing things, so here's a first post to kick it off. I've got a lot of topic ideas to write about, so I'm hoping to stick with this to be able to cover all of those topics. We'll see how well I can do.</p>]]></content:encoded></item></channel></rss>